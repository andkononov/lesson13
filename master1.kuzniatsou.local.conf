<VirtualHost *:443>
  ServerName master1.kuzniatsou.local

  ## Vhost docroot
  DocumentRoot "/usr/share/puppetexplorer/dist"

  ## Directories, there should at least be a declaration for /usr/share/puppetexplorer

  <Directory "/usr/share/puppetexplorer/dist">
    Options Indexes FollowSymLinks MultiViews
    AllowOverride None
    Require all granted
  </Directory>

  ## Logging
  ErrorLog "/var/log/httpd/master.kuzniatsou.local_error_ssl.log"
  ServerSignature Off
  CustomLog "/var/log/httpd/master.kuzniatsou.local_access_ssl.log" combined

  ## Proxy rules
  ProxyRequests Off
  ProxyPreserveHost Off
  ProxyPass /api/pdb/query http://localhost:8080/pdb/query
  ProxyPassReverse /api/pdb/query http://localhost:8080/pdb/query
  ProxyPass /api/pdb/meta http://localhost:8080/pdb/meta
  ProxyPassReverse /api/pdb/meta http://localhost:8080/pdb/meta
  ProxyPass /api/metrics http://localhost:8080/metrics
  ProxyPassReverse /api/metrics http://localhost:8080/metrics
  
  RewriteEngine On
  RewriteRule ^/api/metrics/v1/mbeans/puppetlabs.puppetdb.query.population:type=default,name=(.*)$  http://%{HTTP_HOST}/api/metrics/v1/mbeans/puppetlabs.puppetdb.population:name=$1 [R=301,L]

</VirtualHost>

